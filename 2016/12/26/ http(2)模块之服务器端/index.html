<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>http模块(2)之服务器端 | onejustone'blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">http模块(2)之服务器端</h1><a id="logo" href="/.">onejustone'blog</a><p class="description">--保证独立思维 --</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">http模块(2)之服务器端</h1><div class="post-meta">Dec 26, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-http-模块"><span class="toc-number">1.</span> <span class="toc-text">0x00 http 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-http-模块对-HTTP-服务端的支持"><span class="toc-number">2.</span> <span class="toc-text">0x01 http 模块对 HTTP 服务端的支持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-Server-创建-HTTP-服务器"><span class="toc-number">2.1.</span> <span class="toc-text">http.Server() 创建 HTTP 服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-createServer-requestListener-创建-HTTP-服务器"><span class="toc-number">2.2.</span> <span class="toc-text">http.createServer([requestListener]) 创建 HTTP 服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-关于-http-Server-对象"><span class="toc-number">3.</span> <span class="toc-text">0x02 关于 http.Server 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-Server-对象中的事件"><span class="toc-number">3.1.</span> <span class="toc-text">http.Server 对象中的事件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#request-事件"><span class="toc-number">3.1.1.</span> <span class="toc-text">request 事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#close-事件"><span class="toc-number">3.1.2.</span> <span class="toc-text">close 事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#clientError-事件"><span class="toc-number">3.1.3.</span> <span class="toc-text">clientError 事件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-Server-对象中的方法"><span class="toc-number">3.2.</span> <span class="toc-text">http.Server 对象中的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#server-listen-hostname-port-callbakc"><span class="toc-number">3.2.1.</span> <span class="toc-text">server.listen([hostname],port,callbakc)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-close-callback"><span class="toc-number">3.2.2.</span> <span class="toc-text">server.close([callback])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-setTimeout-msecs-callback"><span class="toc-number">3.2.3.</span> <span class="toc-text">server.setTimeout(msecs, callback)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-Server-对象中的属性"><span class="toc-number">3.3.</span> <span class="toc-text">http.Server 对象中的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#server-maxHeadersCount"><span class="toc-number">3.3.1.</span> <span class="toc-text">server.maxHeadersCount</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#server-timeout"><span class="toc-number">3.3.2.</span> <span class="toc-text">server.timeout</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-http-ServerResponse-对象"><span class="toc-number">4.</span> <span class="toc-text">0x03 http.ServerResponse 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-ServerResponse-中的事件"><span class="toc-number">4.1.</span> <span class="toc-text">http.ServerResponse 中的事件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#close-事件-1"><span class="toc-number">4.1.1.</span> <span class="toc-text">close 事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#finish-事件"><span class="toc-number">4.1.2.</span> <span class="toc-text">finish 事件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-ServerResponse-中的方法"><span class="toc-number">4.2.</span> <span class="toc-text">http.ServerResponse 中的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#response-writeContinue"><span class="toc-number">4.2.1.</span> <span class="toc-text">response.writeContinue()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-writeHead-statusCode-statusMessage-headers"><span class="toc-number">4.2.2.</span> <span class="toc-text">response.writeHead(statusCode[, statusMessage][, headers])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-setHeader-name-value"><span class="toc-number">4.2.3.</span> <span class="toc-text">response.setHeader(name, value)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-setTimeout-msecs-callback"><span class="toc-number">4.2.4.</span> <span class="toc-text">response.setTimeout(msecs, callback)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-write-chunk-encoding"><span class="toc-number">4.2.5.</span> <span class="toc-text">response.write(chunk, [encoding])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-end-data-encoding"><span class="toc-number">4.2.6.</span> <span class="toc-text">response.end([data], [encoding])</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-ServerResponse-中的属性"><span class="toc-number">4.3.</span> <span class="toc-text">http.ServerResponse 中的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#response-statusCode"><span class="toc-number">4.3.1.</span> <span class="toc-text">response.statusCode</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-headersSent"><span class="toc-number">4.3.2.</span> <span class="toc-text">response.headersSent</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#response-sendDate"><span class="toc-number">4.3.3.</span> <span class="toc-text">response.sendDate</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-http-IncomingMessage-对象"><span class="toc-number">5.</span> <span class="toc-text">0x04 http.IncomingMessage 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-IncomingMessage-对象中的事件"><span class="toc-number">5.1.</span> <span class="toc-text">http.IncomingMessage 对象中的事件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#close-事件-2"><span class="toc-number">5.1.1.</span> <span class="toc-text">close 事件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-IncomingMessage-对象中的方法"><span class="toc-number">5.2.</span> <span class="toc-text">http.IncomingMessage 对象中的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#message-setTimeout-msecs-callback"><span class="toc-number">5.2.1.</span> <span class="toc-text">message.setTimeout(msecs, callback)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http-IncomingMessage-对象中的属性"><span class="toc-number">5.3.</span> <span class="toc-text">http.IncomingMessage 对象中的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#message-httpVersion"><span class="toc-number">5.3.1.</span> <span class="toc-text">message.httpVersion</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#message-headers"><span class="toc-number">5.3.2.</span> <span class="toc-text">message.headers</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#message-method"><span class="toc-number">5.3.3.</span> <span class="toc-text">message.method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#message-url"><span class="toc-number">5.3.4.</span> <span class="toc-text">message.url</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#message-statusCode"><span class="toc-number">5.3.5.</span> <span class="toc-text">message.statusCode</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#message-statusCode-1"><span class="toc-number">5.3.6.</span> <span class="toc-text">message.statusCode</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#message-socket"><span class="toc-number">5.3.6.1.</span> <span class="toc-text">message.socket</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-完备的-HTTP-服务器"><span class="toc-number">6.</span> <span class="toc-text">0x05 完备的 HTTP 服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-创建一个-http-Server"><span class="toc-number">6.0.1.</span> <span class="toc-text">1.创建一个 http.Server</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h3 id="0x00-http-模块"><a href="#0x00-http-模块" class="headerlink" title="0x00 http 模块"></a>0x00 http 模块</h3><p>通过 Node.js  的 <code>http</code> 模块中的 <code>http.createServer</code> 方法我们可以很轻松的创建出一个 <code>http</code> 服务器或者使用 <code>http.request</code> 方法创建出一个 <code>http</code> 客户端。 Node 对 HTTP 协议及其相关的 API 的封装是比较底层的其仅能处理流和消息，对于消息的处理，也仅解析成报文头和报文体，但是不解析实际的报文头和报文体内容。如此使得其对 HTTP 的应用更加灵活。</p>
<hr>
<h3 id="0x01-http-模块对-HTTP-服务端的支持"><a href="#0x01-http-模块对-HTTP-服务端的支持" class="headerlink" title="0x01 http 模块对 HTTP 服务端的支持"></a>0x01 http 模块对 HTTP 服务端的支持</h3><p>我们需要通过一个 <code>http.Server</code> 对象来创建一个 HTTP 服务器。<br>有两种方式可以创建出 <code>http.Server</code> 对象，<code>http.createServer()</code> 或 <code>new http.Server()</code>。</p>
<hr>
<h4 id="http-Server-创建-HTTP-服务器"><a href="#http-Server-创建-HTTP-服务器" class="headerlink" title="http.Server() 创建 HTTP 服务器"></a>http.Server() 创建 HTTP 服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line">let http = require(&apos;http&apos;)</div><div class="line"></div><div class="line">// 创建 server 对象，并通过 server 对象的 request 事件添加事件监听器</div><div class="line">let server = new http.Server()</div><div class="line">server.on(&apos;request&apos;,function (req, res) &#123;</div><div class="line">    res.writeHead(200, &#123;&apos;Content-Type&apos;:&apos;text/html&apos;&#125;)</div><div class="line">    res.end(&quot;&lt;h1&gt;hello world!&lt;/h1&gt;&quot;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(8088)</div></pre></td></tr></table></figure>
<hr>
<h4 id="http-createServer-requestListener-创建-HTTP-服务器"><a href="#http-createServer-requestListener-创建-HTTP-服务器" class="headerlink" title="http.createServer([requestListener]) 创建 HTTP 服务器"></a>http.createServer([requestListener]) 创建 HTTP 服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line">let http = require(&apos;http&apos;)</div><div class="line"></div><div class="line">// 创建 server 对象，并添加 request 事件监听器</div><div class="line">let server = http.createServer(function (request, response) &#123;</div><div class="line">    console.log(request.method+&apos;:&apos;+request.url)</div><div class="line">    response.writeHead(200, &#123;&apos;Content-Type&apos;:&apos;text/html&apos;&#125;)</div><div class="line">    response.end(&apos;&lt;h1&gt;hello world&lt;/h1&gt;&apos;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(8088)</div></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-关于-http-Server-对象"><a href="#0x02-关于-http-Server-对象" class="headerlink" title="0x02 关于 http.Server 对象"></a>0x02 关于 http.Server 对象</h3><p><code>http.Server</code> 对象其实是一个事件发射器 <code>EventEmitter</code>。在其事件监听器中也会创建一些对象，如：<code>request</code> 事件会创建http.<code>IncomingMessage</code>和<code>http.ServerResponse</code>。</p>
<hr>
<h4 id="http-Server-对象中的事件"><a href="#http-Server-对象中的事件" class="headerlink" title="http.Server 对象中的事件"></a>http.Server 对象中的事件</h4><p>在此只列出来几个常用的事件。</p>
<h5 id="request-事件"><a href="#request-事件" class="headerlink" title="request 事件"></a>request 事件</h5><p><code>request</code> 事件监听函数为 <code>function (request, response) {}</code>，其接收的两个参数:<code>request</code> 是一个 <code>http.IncomingMessage</code> 实例，而 <code>response</code> 是一个 <code>http.ServerResponse</code> 实例。</p>
<h5 id="close-事件"><a href="#close-事件" class="headerlink" title="close 事件"></a>close 事件</h5><p>其监听函数格式为 <code>function () { }</code> ，当此服务器关闭时触发。</p>
<h5 id="clientError-事件"><a href="#clientError-事件" class="headerlink" title="clientError 事件"></a>clientError 事件</h5><p>其监听函数格式为<code>function (exception, socket) { }</code></p>
<p>当客户端连接触发了一个<code>error</code>事件时，事件会被传送到这里.</p>
<hr>
<h4 id="http-Server-对象中的方法"><a href="#http-Server-对象中的方法" class="headerlink" title="http.Server 对象中的方法"></a>http.Server 对象中的方法</h4><h5 id="server-listen-hostname-port-callbakc"><a href="#server-listen-hostname-port-callbakc" class="headerlink" title="server.listen([hostname],port,callbakc)"></a>server.listen([hostname],port,callbakc)</h5><p>调用 <code>http.Server</code> 对象的 <code>server.listen</code> 事件监听方法以后就可以接受客户端的连接了。</p>
<h5 id="server-close-callback"><a href="#server-close-callback" class="headerlink" title="server.close([callback])"></a>server.close([callback])</h5><p>服务器停止接收新的连接，保持现有连接。当所有连接结束的时候服务器会关闭，并会触发 <code>close</code> 事件。</p>
<h5 id="server-setTimeout-msecs-callback"><a href="#server-setTimeout-msecs-callback" class="headerlink" title="server.setTimeout(msecs, callback)"></a>server.setTimeout(msecs, callback)</h5><p>设置 <code>Socket</code> 套接字的超时时间，单位 msecs 为秒。如果一个超时发生，那么Server对象上会分发一个<code>timeout</code> 事件，同时将套接字作为参数传递。Server默认超时时间为 2 分钟，如果超时将会销毁 <code>Socket</code>。</p>
<hr>
<h4 id="http-Server-对象中的属性"><a href="#http-Server-对象中的属性" class="headerlink" title="http.Server 对象中的属性"></a>http.Server 对象中的属性</h4><h5 id="server-maxHeadersCount"><a href="#server-maxHeadersCount" class="headerlink" title="server.maxHeadersCount"></a>server.maxHeadersCount</h5><p>最大请求头的数量限制，默认 1000。如果设置为 0，则不做任何限制</p>
<h5 id="server-timeout"><a href="#server-timeout" class="headerlink" title="server.timeout"></a>server.timeout</h5><p><code>Socket</code> 套接字被判断为超时时间，单位为毫秒，默认 12000（2分钟）。设置为 0后，则不受超时限制。</p>
<hr>
<h3 id="0x03-http-ServerResponse-对象"><a href="#0x03-http-ServerResponse-对象" class="headerlink" title="0x03 http.ServerResponse 对象"></a>0x03 http.ServerResponse 对象</h3><p><code>http.ServerResponse</code> 是一个由 <code>http.Server</code> 创建的服务器响应对象。在触发<code>request</code>事件后，做事件回调函数的第二个参数传递给回调函数。<code>http.ServerResponse</code> 实现了Writable Stream接口，它同样也是一个 <code>EventEmitter</code>。</p>
<hr>
<h4 id="http-ServerResponse-中的事件"><a href="#http-ServerResponse-中的事件" class="headerlink" title="http.ServerResponse 中的事件"></a>http.ServerResponse 中的事件</h4><h5 id="close-事件-1"><a href="#close-事件-1" class="headerlink" title="close 事件"></a>close 事件</h5><p>事件：<code>close</code>，其监听函数格式为 <code>function () { }</code></p>
<p>在调用 <code>response.end()</code>，或准备 <code>flush</code> 前触发，触发后底层连接结束。</p>
<h5 id="finish-事件"><a href="#finish-事件" class="headerlink" title="finish 事件"></a>finish 事件</h5><p>事件：<code>finish</code>，其监听函数格式为 <code>function () { }</code></p>
<p>发送完响应后（服务器响应完成）触发。响应头和响应体最后一段数据离开操作系统，通过网络来传输时被触发，这并不代表客户端已经收到数据。这个事件之后,<code>http.ServerResponse</code> 不会再触发任何事件。</p>
<hr>
<h4 id="http-ServerResponse-中的方法"><a href="#http-ServerResponse-中的方法" class="headerlink" title="http.ServerResponse 中的方法"></a>http.ServerResponse 中的方法</h4><h5 id="response-writeContinue"><a href="#response-writeContinue" class="headerlink" title="response.writeContinue()"></a>response.writeContinue()</h5><p>发送HTTP/1.1 100 Continue 消息给客户端，表示请求体可以发送，会触发 <code>http.Server</code> 的<code>checkContinue</code> 事件。</p>
<h5 id="response-writeHead-statusCode-statusMessage-headers"><a href="#response-writeHead-statusCode-statusMessage-headers" class="headerlink" title="response.writeHead(statusCode[, statusMessage][, headers])"></a>response.writeHead(statusCode[, statusMessage][, headers])</h5><p>向客户端请求发送一个响应头。<code>statusCode</code> 状态码是 3 位数字，如：404。可通过 <code>statusMessage</code> 设置状态消息。最后一个参数 <code>headers</code> 是响应头。</p>
<p>该方法方法在当前请求中仅能调用一次，而且必须在 <code>response.end()</code> 前调用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">let body = &apos;example.com&apos;</div><div class="line">response.writeHead(200, &apos;OK&apos;,&#123;</div><div class="line">    &apos;Content-Length&apos;:body.length,</div><div class="line">    &apos;Content-Type&apos;:&apos;text/plain&apos;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h5 id="response-setHeader-name-value"><a href="#response-setHeader-name-value" class="headerlink" title="response.setHeader(name, value)"></a>response.setHeader(name, value)</h5><p>为默认或者已存在的头设置一条单独的头内容。如果这个头已经存在于，将会覆盖原来的内容。如果想设置多个值， 就使用一个相同名字的字符串数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">response.setHeader(&apos;Content-Type&apos;, &apos;text/html&apos;)</div><div class="line">response.setHeader(&apos;Set-Cookie&apos;, [&apos;userName = jack&apos;,&apos;password=123&apos;])</div></pre></td></tr></table></figure>
<h5 id="response-setTimeout-msecs-callback"><a href="#response-setTimeout-msecs-callback" class="headerlink" title="response.setTimeout(msecs, callback)"></a>response.setTimeout(msecs, callback)</h5><p>设置<code>Socket</code>套接字的超时时间，单位 <code>msecs</code> 为秒。如果提供了回调函数，其将会做为响应对象的<code>timeout</code>事件的监听器。</p>
<h5 id="response-write-chunk-encoding"><a href="#response-write-chunk-encoding" class="headerlink" title="response.write(chunk, [encoding])"></a>response.write(chunk, [encoding])</h5><p>向响应流发送一个数据块。这个方法可能被调用多次，以提供响应体内容。如果调用了这个方法，但还没有调用 <code>response.writeHead()</code>，将会向响应体提供默认的 <code>header</code>。</p>
<p>参数chunk可以是字符串或者Buffer缓存。</p>
<h5 id="response-end-data-encoding"><a href="#response-end-data-encoding" class="headerlink" title="response.end([data], [encoding])"></a>response.end([data], [encoding])</h5><p>当所有的响应报头和报文被发送完成时这个方法将信号发送给服务器，服务器会认为这个消息完成了。 每次响应完成之后必须调用该方法。</p>
<p>如果指定了参数 <code>data</code>，就相当于先调用 <code>response.write(data, encoding)</code> 再调用 <code>response.end()</code>。</p>
<hr>
<h4 id="http-ServerResponse-中的属性"><a href="#http-ServerResponse-中的属性" class="headerlink" title="http.ServerResponse 中的属性"></a>http.ServerResponse 中的属性</h4><h5 id="response-statusCode"><a href="#response-statusCode" class="headerlink" title="response.statusCode"></a>response.statusCode</h5><p>当使用默认 <code>header</code> 时（没有显式地调用 <code>response.writeHead()</code> 来修改 <code>header</code>），这个属性决定 <code>header</code> 更新时被传回客户端的HTTP状态码。当响应头已经被发送回客户端，那么这个属性则表示已经被发送出去的状态码。</p>
<h5 id="response-headersSent"><a href="#response-headersSent" class="headerlink" title="response.headersSent"></a>response.headersSent</h5><p><code>Boolean</code> 值(只读)，如果 <code>headers</code> 发送完毕，则为 <code>true</code>，否则为 <code>false</code>。</p>
<h5 id="response-sendDate"><a href="#response-sendDate" class="headerlink" title="response.sendDate"></a>response.sendDate</h5><p>默认值为 <code>true</code>。若为 <code>true</code>，当 <code>headers</code> 里没有 <code>Date</code> 值时，自动生成 <code>Date</code> 并发送。只有在测试环境才能禁用，因为HTTP要求响应包含 <code>Date</code> 头。</p>
<hr>
<h3 id="0x04-http-IncomingMessage-对象"><a href="#0x04-http-IncomingMessage-对象" class="headerlink" title="0x04 http.IncomingMessage 对象"></a>0x04 http.IncomingMessage 对象</h3><p><code>IncomingMessage</code> 对象是由 <code>http.Server</code> 或 <code>http.ClientRequest</code> 创建的，并作为第一参数分别传递给 <code>http.Server</code>的 <code>request</code> 事件和 <code>http.ClientRequest</code> 的 <code>response</code> 事件。它也可以用来访问应答的状态、头文件和数据等。 <code>IncomingMessage</code> 对象实现了 <code>Readable Stream</code> 接口，对象中还有一些事件，方法和属性。<code>在http.Server</code> 或 <code>http.ClientRequest</code> 中略有不同。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的事件"><a href="#http-IncomingMessage-对象中的事件" class="headerlink" title="http.IncomingMessage 对象中的事件"></a>http.IncomingMessage 对象中的事件</h4><h5 id="close-事件-2"><a href="#close-事件-2" class="headerlink" title="close 事件"></a>close 事件</h5><p><code>close</code> 事件表示在 <code>response.end()</code> 被调用或强制刷新之前，底层的连接已经被终止了。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的方法"><a href="#http-IncomingMessage-对象中的方法" class="headerlink" title="http.IncomingMessage 对象中的方法"></a>http.IncomingMessage 对象中的方法</h4><h5 id="message-setTimeout-msecs-callback"><a href="#message-setTimeout-msecs-callback" class="headerlink" title="message.setTimeout(msecs, callback)"></a>message.setTimeout(msecs, callback)</h5><p>设置连接超时，参数 <code>msecs</code> 为超时时间（秒）。该方法本质是调用 <code>message.connection.setTimeout(msecs, callback)</code> 方法。</p>
<hr>
<h4 id="http-IncomingMessage-对象中的属性"><a href="#http-IncomingMessage-对象中的属性" class="headerlink" title="http.IncomingMessage 对象中的属性"></a>http.IncomingMessage 对象中的属性</h4><h5 id="message-httpVersion"><a href="#message-httpVersion" class="headerlink" title="message.httpVersion"></a>message.httpVersion</h5><p><code>message.httpVersion</code>：在http.Server中表示客户端向服务器发出请求时，客户端发送的HTTP版本；在http.ClientRequest中表示服务器向客户端返回应答时，服务器的HTTP版本</p>
<h5 id="message-headers"><a href="#message-headers" class="headerlink" title="message.headers"></a>message.headers</h5><p><code>message.headers</code>: 请求/响应头对象。只读的文件头信息的键值对的集合，全小写。</p>
<h5 id="message-method"><a href="#message-method" class="headerlink" title="message.method"></a>message.method</h5><p><code>message.method</code>：仅对http.Server有效，表示客户端的HTTP请求方式</p>
<h5 id="message-url"><a href="#message-url" class="headerlink" title="message.url"></a>message.url</h5><p><code>message.url</code>：仅对http.Server有效，表示客户端请求的URL字符串。</p>
<h5 id="message-statusCode"><a href="#message-statusCode" class="headerlink" title="message.statusCode"></a>message.statusCode</h5><p><code>message.statusCode</code>：仅对 <code>http.ClientRequest</code> 有效，表示HTTP服务器的响应状态，如：200、404等。</p>
<h5 id="message-statusCode-1"><a href="#message-statusCode-1" class="headerlink" title="message.statusCode"></a>message.statusCode</h5><p><code>message.statusCode</code>：仅对 <code>http.ClientRequest</code> 有效，表示HTTP服务器的响应状态信息，如：OK、Internal Server Error等。</p>
<h6 id="message-socket"><a href="#message-socket" class="headerlink" title="message.socket"></a>message.socket</h6><p><code>message.socket</code>：与此连接关联的net.Socket对象</p>
<hr>
<h3 id="0x05-完备的-HTTP-服务器"><a href="#0x05-完备的-HTTP-服务器" class="headerlink" title="0x05 完备的 HTTP 服务器"></a>0x05 完备的 HTTP 服务器</h3><h5 id="1-创建一个-http-Server"><a href="#1-创建一个-http-Server" class="headerlink" title="1.创建一个 http.Server"></a>1.创建一个 http.Server</h5><p>不同于 <code>new http.Server()</code> 的方式，使用 <code>http.createServer</code> 方法来创建一个 <code>http.Serve</code> 的实例，不需要为其显示的添加 <code>request</code> 事件处理程序，因为它将会自动在服务端监听来自客户端的  <code>request</code> 事件,然后在其回调函数中会返回一个 <code>http.IncomingMessage(req)</code> 实例和一个  <code>http.ServerResponse(res)</code> 实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by onejustone on 2016/12/26.</div><div class="line"> *</div><div class="line"> * @param &#123;Object&#125; req 是一个http.IncomingMessag实例</div><div class="line"> * @param &#123;Object&#125; res 是一个http.ServerResponse实例</div><div class="line"> */</div><div class="line"> </div><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">let http = require(&apos;http&apos;)</div><div class="line">// 导入 http m模块</div><div class="line"></div><div class="line">let server = http.createServer(function (req, res) &#123;</div><div class="line">// 创建 http server</div><div class="line">    res.writeHeader(200, &#123;&apos;Content-Type&apos;:&apos;video/mp4&apos;&#125;)</div><div class="line">    // 改写响应的头部信息 </div><div class="line">    let rs = require(&apos;fs&apos;).createReadStream(&apos;./臭屁虫2.mp4&apos;)</div><div class="line">    // 创建一个流文件，读取 MP4 媒体数据</div><div class="line">    rs.pipe(res)</div><div class="line">    // 将 MP4 文件流通过管道输送到 HTTP 响应中</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.maxHeadersCount = 1000;</div><div class="line">// 设置最大请求头限制</div><div class="line">server.setTimeout(1000,function () &#123;</div><div class="line">// 设置套接字超时时间</div><div class="line">    console.log(&quot;oh, time out~~&quot;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line">server.listen(8088, function () &#123;</div><div class="line">// 监听本地端口。启动服务器</div><div class="line">    console.log(&apos;服务器已启动！&apos;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><code>http.ServerResponse</code> 实例是一个可写流，所以可以将一个文件流转接到 <code>res</code> 响应流中，然后传输给客户端。</p>
<p>此外，我们还有可以通过 <code>req.headers</code> 来查看客户端的请求信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">let server = http.createServer(function (req, res) &#123;</div><div class="line">    console.log(req.headers)</div><div class="line">    res.writeHeader(200, &#123;&apos;Content-Type&apos;:&apos;text/plain&apos;&#125;)</div><div class="line">    res.end()</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://onejustone.xyz/2016/12/26/ http(2)模块之服务器端/" data-id="cj0uq9jgm000lcuvsxaw0l5d6" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Node-js/">Node.js</a><a href="/tags/http模块/">http模块</a></div><div class="post-nav"><a href="/2016/12/27/http模块(1)之客户端/" class="pre">http模块(1)之客户端</a><a href="/2016/12/26/ ES6(8)函数/" class="next">ES6(8)函数</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://onejustone.xyz"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CROS/" style="font-size: 15px;">CROS</a> <a href="/tags/Linux进程/" style="font-size: 15px;">Linux进程</a> <a href="/tags/AngularJS/" style="font-size: 15px;">AngularJS</a> <a href="/tags/Python爬虫/" style="font-size: 15px;">Python爬虫</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/JS对象/" style="font-size: 15px;">JS对象</a> <a href="/tags/前端模块化/" style="font-size: 15px;">前端模块化</a> <a href="/tags/算法入门/" style="font-size: 15px;">算法入门</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/http模块/" style="font-size: 15px;">http模块</a> <a href="/tags/Java基础/" style="font-size: 15px;">Java基础</a> <a href="/tags/AngularJS深入/" style="font-size: 15px;">AngularJS深入</a> <a href="/tags/Kali渗透测试/" style="font-size: 15px;">Kali渗透测试</a> <a href="/tags/Web渗透测试/" style="font-size: 15px;">Web渗透测试</a> <a href="/tags/Windows工具篇/" style="font-size: 15px;">Windows工具篇</a> <a href="/tags/工具篇/" style="font-size: 15px;">工具篇</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/CSS界面组件/" style="font-size: 15px;">CSS界面组件</a> <a href="/tags/Cmder/" style="font-size: 15px;">Cmder</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Web程序设计/" style="font-size: 15px;">Web程序设计</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/MyFirstApp/" style="font-size: 15px;">MyFirstApp</a> <a href="/tags/Kali第六章/" style="font-size: 15px;">Kali第六章</a> <a href="/tags/被动信息收集/" style="font-size: 15px;">被动信息收集</a> <a href="/tags/Apache2/" style="font-size: 15px;">Apache2</a> <a href="/tags/View-Urls/" style="font-size: 15px;">View,Urls</a> <a href="/tags/Models/" style="font-size: 15px;">Models</a> <a href="/tags/前端工具流/" style="font-size: 15px;">前端工具流</a> <a href="/tags/版本控制工具/" style="font-size: 15px;">版本控制工具</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Java-J2EE/" style="font-size: 15px;">Java-J2EE</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/DOM/" style="font-size: 15px;">DOM</a> <a href="/tags/JS事件/" style="font-size: 15px;">JS事件</a> <a href="/tags/JS变量作用域和内存/" style="font-size: 15px;">JS变量作用域和内存</a> <a href="/tags/JS引用类型/" style="font-size: 15px;">JS引用类型</a> <a href="/tags/Cookie/" style="font-size: 15px;">Cookie</a> <a href="/tags/LocalStorage/" style="font-size: 15px;">LocalStorage</a> <a href="/tags/同源策略与CORS/" style="font-size: 15px;">同源策略与CORS</a> <a href="/tags/表单脚本/" style="font-size: 15px;">表单脚本</a> <a href="/tags/Ajax/" style="font-size: 15px;">Ajax</a> <a href="/tags/JSON/" style="font-size: 15px;">JSON</a> <a href="/tags/ES6/" style="font-size: 15px;">ES6</a> <a href="/tags/JS正则/" style="font-size: 15px;">JS正则</a> <a href="/tags/JS设计模式/" style="font-size: 15px;">JS设计模式</a> <a href="/tags/JS离线应用与客户端存储/" style="font-size: 15px;">JS离线应用与客户端存储</a> <a href="/tags/JS高阶/" style="font-size: 15px;">JS高阶</a> <a href="/tags/Java应用/" style="font-size: 15px;">Java应用</a> <a href="/tags/kali之滚动更新/" style="font-size: 15px;">kali之滚动更新</a> <a href="/tags/Kali安装与环境优化/" style="font-size: 15px;">Kali安装与环境优化</a> <a href="/tags/渗透手册/" style="font-size: 15px;">渗透手册</a> <a href="/tags/漏洞扫描/" style="font-size: 15px;">漏洞扫描</a> <a href="/tags/kali渗透测试/" style="font-size: 15px;">kali渗透测试</a> <a href="/tags/主动信息收集/" style="font-size: 15px;">主动信息收集</a> <a href="/tags/photoshop/" style="font-size: 15px;">photoshop</a> <a href="/tags/Python基础/" style="font-size: 15px;">Python基础</a> <a href="/tags/Python标准库/" style="font-size: 15px;">Python标准库</a> <a href="/tags/Python网络/" style="font-size: 15px;">Python网络</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/JSX/" style="font-size: 15px;">JSX</a> <a href="/tags/CSS预处理/" style="font-size: 15px;">CSS预处理</a> <a href="/tags/SQL查询的艺术/" style="font-size: 15px;">SQL查询的艺术</a> <a href="/tags/SQL基础/" style="font-size: 15px;">SQL基础</a> <a href="/tags/kali第五章/" style="font-size: 15px;">kali第五章</a> <a href="/tags/基本工具/" style="font-size: 15px;">基本工具</a> <a href="/tags/JS小项目/" style="font-size: 15px;">JS小项目</a> <a href="/tags/Vue-js/" style="font-size: 15px;">Vue.js</a> <a href="/tags/kali系统配置/" style="font-size: 15px;">kali系统配置</a> <a href="/tags/fs模块/" style="font-size: 15px;">fs模块</a> <a href="/tags/响应式布局/" style="font-size: 15px;">响应式布局</a> <a href="/tags/前端工具化/" style="font-size: 15px;">前端工具化</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/前端之坑/" style="font-size: 15px;">前端之坑</a> <a href="/tags/前端实战/" style="font-size: 15px;">前端实战</a> <a href="/tags/前端漫话之网络/" style="font-size: 15px;">前端漫话之网络</a> <a href="/tags/存储过程与函数/" style="font-size: 15px;">存储过程与函数</a> <a href="/tags/完整性约束/" style="font-size: 15px;">完整性约束</a> <a href="/tags/CSS小技巧/" style="font-size: 15px;">CSS小技巧</a> <a href="/tags/模块/" style="font-size: 15px;">模块</a> <a href="/tags/深入浅出Node-js学习笔记/" style="font-size: 15px;">深入浅出Node.js学习笔记</a> <a href="/tags/Android开发/" style="font-size: 15px;">Android开发</a> <a href="/tags/鸟哥服务器篇读书笔记/" style="font-size: 15px;">鸟哥服务器篇读书笔记</a> <a href="/tags/鸟哥的Linux读书笔记基础篇/" style="font-size: 15px;">鸟哥的Linux读书笔记基础篇</a> <a href="/tags/索引与视图/" style="font-size: 15px;">索引与视图</a> <a href="/tags/CSS进阶/" style="font-size: 15px;">CSS进阶</a> <a href="/tags/Secrets/" style="font-size: 15px;">Secrets</a> <a href="/tags/触发器/" style="font-size: 15px;">触发器</a> <a href="/tags/协议分析/" style="font-size: 15px;">协议分析</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/26/yarn初步/">yarn初步</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/17/Linux-PID进程追踪/">Linux-PID进程追踪</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/AngularJS深入(1)之ui-router/">AngularJS深入(1)之ui.router</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/23/ 前端模块化(1)之各种规范/">前端模块化(1)之各种规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/18/Vue-js(进阶)自定义指令/">Vue.j(进阶)自定义指令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/18/Vue-js(进阶)Render函数/">Vue.j(进阶)Render函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/18/Vue-js概览/">Vue.js概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/18/深入浅出Node-js番外篇(1)node版本管理/">深入浅出Node.js番外篇(1)node版本管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/14/ 前端模块化(2)之requireJS/">JavaScript模块化(2)之requireJS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/11/AngularJS(9)高级指令/">AngularJS(9)高级指令</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">onejustone'blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>